#define TRIG 2
#define ECHO 3
#define LED_PIN 4  // Definindo o pino do LED
#define PIEZO_PIN 5 // Definindo o pino do Piezo

long distancia;
int entradas = 0;

long medirDistancia() {
  digitalWrite(TRIG, LOW);
  delayMicroseconds(5);
  digitalWrite(TRIG, HIGH);
  delayMicroseconds(10);
  digitalWrite(TRIG, LOW);

  long duracao = pulseIn(ECHO, HIGH, 25000);
  if (duracao == 0) return 999; // nada detectado

  return (duracao * 0.034) / 2;
}

void setup() {
  Serial.begin(9600);
  pinMode(TRIG, OUTPUT);
  pinMode(ECHO, INPUT);
  pinMode(LED_PIN, OUTPUT);     // Definindo o pino do LED como saída
  pinMode(PIEZO_PIN, OUTPUT);   // Definindo o pino do Piezo como saída

  Serial.println("Contador de Entradas Iniciado");
}

void loop() {
  distancia = medirDistancia();

  if (distancia < 40) {    
    entradas++;
    Serial.print("Entrada detectada! Total: ");
    Serial.println(entradas);

    // Acende o LED quando uma entrada é detectada
    digitalWrite(LED_PIN, HIGH);
    
    // Emite um som com o piezo
    tone(PIEZO_PIN, 1000, 200); // 1000Hz por 200ms
    
    delay(1500);  // espera a pessoa sair

    // Desliga o LED após o tempo de espera
    digitalWrite(LED_PIN, LOW);
  }

  delay(100);
}
